import{F as C,s as F,a as L,j as e,c as b,R as E}from"./index-9aebd368.js";import{r as A}from"./react-query-805b988f.js";import{r as a,a as q}from"./react-5284b0bf.js";import{u as I,b as P,L as S,c as M}from"./react-router-dom-d629d609.js";import{u as D}from"./useAppConfigQuery-d360e15d.js";function R(){const s=a.useContext(C);return a.useCallback(async(o,n)=>await F(s.auth,o,n),[s.auth])}function W(){const s=a.useContext(C);return a.useCallback(async(o,n)=>await L(s.auth,o,n),[s.auth])}function O({children:s}){return A.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay"}),e.jsx("div",{className:"modal",children:s})]}),document.getElementById("portal"))}function U(s){const r=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return!!s.match(r)}function N(s){return!0}const y=new Map([["auth/email-already-in-use",{type:"email",message:"Email is already in use."}],["auth/user-not-found",{type:"email",message:"Email Doesn't Exists"}],["auth/wrong-password",{type:"password",message:"Wrong Password"}],["invalid-email",{type:"email",message:"Invalid Email"}],["invalid-password",{type:"password",message:"Invalid Password"}],["unequal-password",{type:"confirm-password",message:"Passwords does not match"}],["new-signup-not-allowed",{type:"email",message:"New sign up is not allowed"}]]);function T({type:s,code:r,fallbackMessage:o}){var i,d;let n="",l=!0;return r===null||((i=y.get(r))==null?void 0:i.type)!==s?l=!1:n=((d=y.get(r))==null?void 0:d.message)??o??"Unknown Error",e.jsx("div",{className:`error-text ${l?"visible":"hidden"}`,children:n})}const g=q.memo(T);function $(){const s=I(),r=a.useId(),o=a.useId(),[n,l]=a.useState(""),[i,d]=a.useState(""),[p,c]=a.useState(null),j=R(),x=P(),w=a.useCallback(()=>{l(""),d("")},[]);return e.jsxs("form",{className:"form-auth form-auth_login",onSubmit:t=>{t.preventDefault();let h=!0;U(n)||(c("invalid-email"),h=!1),h&&!N()&&(c("invalid-password"),h=!1),h?j(n,i).then(()=>{var m;(m=s.state)!=null&&m.from?x(s.state.from.pathname,{replace:!0}):x("/",{replace:!0})}).catch(m=>{c(m.code)}):w()},children:[e.jsx("h2",{children:"Login"}),e.jsx(g,{code:p,fallbackMessage:"Could Not Login"}),e.jsxs("div",{className:"input-field",children:[e.jsx("label",{htmlFor:r,children:"Email"}),e.jsx("input",{type:"email",id:r,autoComplete:"email",value:n,onChange:t=>{l(t.target.value),c(null)},required:!0}),e.jsx(g,{code:p,type:"email"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("label",{htmlFor:o,children:"Password"}),e.jsx("input",{type:"password",id:o,autoComplete:"current-password",value:i,onChange:t=>{d(t.target.value),c(null)},required:!0}),e.jsx(g,{code:p,type:"password"})]}),e.jsx("button",{type:"submit",children:"Login"}),e.jsx(S,{replace:!0,to:b({path:E.AUTH,params:{type:"signup"}}),state:s.state,children:"Sign Up"})]})}function H(){const s=I(),r=D("public",u=>u.newSignUpAllowed),o=a.useId(),n=a.useId(),l=a.useId(),[i,d]=a.useState(""),[p,c]=a.useState(""),[j,x]=a.useState(""),[w,t]=a.useState(null),h=W(),m=P(),k=a.useCallback(()=>{d(""),c(""),x("")},[]);return e.jsxs("form",{className:"form-auth form-auth_signup",onSubmit:u=>{u.preventDefault();let f=!0;U(i)||(t("invalid-email"),f=!1),f&&!N()&&(t("invalid-password"),f=!1),f&&p!==j&&(t("unequal-password"),f=!1),(r.isError||!r.data)&&(t("new-signup-not-allowed"),f=!1),f?h(i,p).then(()=>{var v;(v=s.state)!=null&&v.from?m(s.state.from.pathname,{replace:!0}):m("/",{replace:!0})}).catch(v=>{t(v.code)}):k()},children:[e.jsx("h2",{children:"Sign Up"}),e.jsx(g,{code:w,fallbackMessage:"Could Not Sign Up"}),e.jsxs("div",{className:"input-field",children:[e.jsx("label",{htmlFor:o,children:"Email"}),e.jsx("input",{type:"email",id:o,autoComplete:"email",value:i,onChange:u=>{d(u.target.value),t(null)},required:!0}),e.jsx(g,{code:w,type:"email"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("label",{htmlFor:n,children:"Password"}),e.jsx("input",{type:"password",id:n,autoComplete:"new-password",value:p,onChange:u=>{c(u.target.value),t(null)},required:!0}),e.jsx(g,{code:w,type:"password"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("label",{htmlFor:l,children:"Confirm Password"}),e.jsx("input",{type:"password",id:l,autoComplete:"new-password",value:j,onChange:u=>{x(u.target.value),t(null)},required:!0}),e.jsx(g,{code:w,type:"confirm-password"})]}),e.jsx("button",{type:"submit",children:"Sign Up"}),e.jsx(S,{replace:!0,to:b({path:E.AUTH,params:{type:"login"}}),state:s.state,children:"Login"})]})}function G(){const{type:s}=M();return e.jsx(O,{children:s==="login"?e.jsx($,{}):e.jsx(H,{})})}export{G as default};
